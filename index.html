<script>
  function getStatusClass(status) {
    switch (status) {
      case "Not banned": return "not-banned";
      case "Temporarily banned": return "temp-banned";
      case "Permanently banned": return "perm-banned";
      default: return "unknown";
    }
  }

  async function checkBan() {
    const playerInput = document.getElementById("playerInput").value.trim();
    const platform = document.getElementById("platformSelect").value;
    const resultsDiv = document.getElementById("results");

    if (!playerInput) {
      alert("Please enter at least one player name.");
      return;
    }

    // Optional: limit batch size for safety
    const players = playerInput.split(",").map(p => p.trim()).filter(p => p);
    if (players.length > 20) {
      alert("Please check 20 or fewer players at a time.");
      return;
    }

    resultsDiv.innerHTML = "<p class='loading'>Checkingâ€¦ please wait</p>";

    try {
      const response = await fetch(
        `https://pubg-ban-checker-backend.onrender.com/check-ban?player=${encodeURIComponent(playerInput)}&platform=${platform}`
      );

      const data = await response.json();
      resultsDiv.innerHTML = "";

      if (response.status === 429) {
        resultsDiv.innerHTML = "<p class='unknown'>Rate limit exceeded. Try fewer players or wait a few seconds.</p>";
        return;
      }

      if (data.error) {
        resultsDiv.innerHTML = `<p class='unknown'>Error: ${data.error}</p>`;
        return;
      }

      if (data.results && data.results.length > 0) {
        const groupDiv = document.createElement("div");
        groupDiv.className = "group-result";

        data.results.forEach(item => {
          const row = document.createElement("div");
          row.className = "player-row";
          const statusClass = getStatusClass(item.banStatus);
          row.innerHTML = `<strong>${item.player}:</strong> <span class="status ${statusClass}">${item.banStatus}</span>`;
          groupDiv.appendChild(row);
        });

        resultsDiv.appendChild(groupDiv);
      } else {
        resultsDiv.innerHTML = "No results found.";
      }

    } catch (err) {
      resultsDiv.innerHTML = `<p class='unknown'>Error fetching results: ${err}</p>`;
    }
  }

  function clearResults() {
    document.getElementById("results").innerHTML = "";
    document.getElementById("playerInput").value = "";
  }

  // Allow pressing ENTER to trigger check
  document.getElementById("playerInput").addEventListener("keypress", function (e) {
    if (e.key === "Enter") {
      checkBan();
    }
  });
</script>
