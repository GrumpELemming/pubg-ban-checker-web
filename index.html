<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PUBG Ban Checker</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 50px auto; }
        input, button { padding: 8px; font-size: 16px; margin: 5px 0; }
        .result { margin-top: 10px; }
        #watchlist div { margin: 2px 0; }
        .removeBtn { margin-left: 5px; }
    </style>
</head>
<body>

<h1>PUBG Ban Checker</h1>

<label for="players">Enter player names:</label><br>
<input type="text" id="players" list="suggestions" placeholder="RoboLemming5000">
<datalist id="suggestions"></datalist>
<button id="addBtn">Add to Watchlist</button>
<button id="checkBtn">Check Ban Status</button>

<h2>Watchlist</h2>
<div id="watchlist"></div>

<div class="result" id="results"></div>

<script>
const input = document.getElementById('players');
const dataList = document.getElementById('suggestions');
const resultsDiv = document.getElementById('results');
const checkBtn = document.getElementById('checkBtn');
const addBtn = document.getElementById('addBtn');
const watchlistDiv = document.getElementById('watchlist');

let watchlist = JSON.parse(localStorage.getItem('watchlist') || '[]');

function renderWatchlist() {
    watchlistDiv.innerHTML = '';
    watchlist.forEach(player => {
        const div = document.createElement('div');
        div.textContent = player;
        const removeBtn = document.createElement('button');
        removeBtn.textContent = 'Remove';
        removeBtn.classList.add('removeBtn');
        removeBtn.onclick = () => {
            watchlist = watchlist.filter(p => p !== player);
            localStorage.setItem('watchlist', JSON.stringify(watchlist));
            renderWatchlist();
        };
        div.appendChild(removeBtn);
        watchlistDiv.appendChild(div);
    });
}
renderWatchlist();

input.addEventListener('input', async () => {
    const current = input.value.trim();
    if (!current) return;

    try {
        const response = await fetch(`https://pubg-ban-checker-backend.onrender.com/suggest-players?q=${encodeURIComponent(current)}`);
        const suggestions = await response.json();
        dataList.innerHTML = '';
        suggestions.forEach(name => {
            const option = document.createElement('option');
            option.value = name;
            dataList.appendChild(option);
        });
    } catch (err) {
        dataList.innerHTML = '';
    }
});

addBtn.addEventListener('click', () => {
    const player = input.value.trim();
    if (player && !watchlist.includes(player)) {
        watchlist.push(player);
        localStorage.setItem('watchlist', JSON.stringify(watchlist));
        renderWatchlist();
    }
    input.value = '';
});

checkBtn.addEventListener('click', async () => {
    resultsDiv.innerHTML = '';
    const playersToCheck = [...watchlist];
    if (!playersToCheck.length) {
        resultsDiv.textContent = 'Your watchlist is empty.';
        return;
    }

    for (const player of playersToCheck) {
        try {
            const response = await fetch(`https://pubg-ban-checker-backend.onrender.com/check-ban?player=${encodeURIComponent(player)}&platform=steam`);
            const data = await response.json();
            const div = document.createElement('div');
            div.textContent = `${player}: ${data.banStatus || data.error}`;
            resultsDiv.appendChild(div);
        } catch (err) {
            const div = document.createElement('div');
            div.textContent = `${player}: Failed to fetch`;
            resultsDiv.appendChild(div);
        }
    }
});
</script>

</body>
</html>
