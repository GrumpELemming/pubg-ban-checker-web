<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PUBG Ban Checker v1.5</title>
<style>
  /* theme & layout */
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0; padding: 0;
    background: linear-gradient(135deg,#1f1c2c,#928dab);
    color:#f0f0f0;
    display:flex; flex-direction:column; align-items:center;
    min-height:100vh;
  }
  h1 { font-size:2.2em; margin-top:40px; margin-bottom:10px; color:#ffdd59; text-align:center; }
  h2 { font-size:1em; margin-bottom:10px; color:#ffd700; text-align:center; }
  .note { font-size:0.9em; color:#ffebcd; margin-top:-5px; margin-bottom:25px; text-align:center; font-style:italic; }

  .controls, .watchlist-controls {
    background-color: rgba(255,255,255,0.1);
    padding:15px 20px; border-radius:12px;
    box-shadow:0 4px 10px rgba(0,0,0,0.3);
    display:flex; flex-wrap:wrap; justify-content:center; gap:10px;
    margin-bottom:15px; position:relative;
  }

  input, button, select { padding:10px 12px; font-size:1em; border-radius:6px; border:none; outline:none; }
  input { flex:1 1 200px; min-width:200px; position:relative; z-index:2; }
  select { background:#fff; color:#333; }
  button {
    background-color:#ff4757; color:white; font-weight:bold;
    transition:background .3s; position:relative; z-index:2; cursor:pointer;
  }
  button:hover { background:#e84118; }

  #results, #watchlist { width:90%; max-width:600px; margin-bottom:20px; }
  #watchlist { padding:10px; border:1px solid rgba(255,255,255,0.3); border-radius:8px; background-color:rgba(0,0,0,0.18); }
  .watchlist-name { display:flex; justify-content:space-between; margin:4px 0; padding:4px 8px; border-radius:6px; background-color:rgba(255,255,255,0.06); }
  .watchlist-name button { background:#ff6b81; color:white; border:none; border-radius:4px; padding:2px 6px; cursor:pointer; font-size:0.85em; }
  .watchlist-name button:hover { background:#e84118; }

  @keyframes cardPop { 0%{background-color:rgba(255,255,255,0);transform:scale(.95);}50%{background-color:rgba(255,255,255,.15);transform:scale(1.02);}100%{background-color:rgba(255,255,255,.1);transform:scale(1);} }
  .group-result { margin-bottom:20px;padding:15px;border-radius:8px;background-color:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.12); animation:cardPop .6s ease forwards; }

  @keyframes fadeInUp { 0%{opacity:0;transform:translateY(10px);}100%{opacity:1;transform:translateY(0);} }
  .player-row { margin:6px 0;padding:6px 10px;border-radius:6px;animation:fadeInUp .4s ease forwards;display:flex;justify-content:space-between;align-items:center; gap:10px; }
  .loading { font-style:italic;color:#ddd; }

  @keyframes pulseRed {0%{box-shadow:0 0 0 rgba(255,0,0,.7);}50%{box-shadow:0 0 15px rgba(255,0,0,.9);}100%{box-shadow:0 0 0 rgba(255,0,0,.7);} }
  @keyframes pulseYellow {0%{box-shadow:0 0 0 rgba(255,255,0,.7);}50%{box-shadow:0 0 15px rgba(255,255,0,.9);}100%{box-shadow:0 0 0 rgba(255,255,0,.7);} }
  @keyframes pulseGreen {0%{box-shadow:0 0 0 rgba(0,255,0,.6);}50%{box-shadow:0 0 10px rgba(0,255,0,.8);}100%{box-shadow:0 0 0 rgba(0,255,0,.6);} }

  .not-banned { background:linear-gradient(90deg,#28a745,#2ecc71); color:white; animation:pulseGreen 1.2s ease-in-out 1; }
  .temp-banned { background:linear-gradient(90deg,#ffc107,#ffcd39); color:black; animation:pulseYellow 1.2s ease-in-out 1; }
  .perm-banned { background:linear-gradient(90deg,#dc3545,#e74c3c); color:white; animation:pulseRed 1.2s ease-in-out 1; }
  .unknown { background:linear-gradient(90deg,#6c757d,#95a5a6); color:white; }

  /* watchlist badge for highlighting */
  .watchlist-badge {
    display:inline-block;
    background:rgba(255,215,0,0.12);
    color:#ffd700;
    border:1px solid rgba(255,215,0,0.2);
    padding:3px 8px;
    border-radius:12px;
    font-size:0.85em;
    margin-left:8px;
  }

  footer { text-align:center; margin-bottom:10px; font-size:0.9em; color:#ffebcd; }
  footer a { color:#ffd700; text-decoration:none; }
  footer a:hover { text-decoration:underline; }

  /* suggestions */
  #suggestions { position:absolute; background:rgba(255,255,255,0.95); color:#333; border-radius:6px; max-height:150px; overflow-y:auto; display:none; z-index:10; box-shadow:0 6px 20px rgba(0,0,0,0.25); }
  .suggestion-item { padding:6px 10px; cursor:pointer; }
  .suggestion-item:hover, .suggestion-active { background-color:#f0f0f0; }
</style>
</head>
<body>

<h1>PUBG Ban Checker v1.5</h1>
<h2>Check if players are banned on Steam, Xbox, or PlayStation</h2>
<p class="note">Enter up to 10 player names separated by commas.<br><em>Example: PlayerOne, PlayerTwo, PlayerThree</em></p>

<div class="controls">
  <input id="playerInput" type="text" placeholder="Enter player names, separated by commas (max 10)" autocomplete="off">
  <select id="platformSelect">
    <option value="steam">Steam</option>
    <option value="xbox">Xbox</option>
    <option value="psn">PlayStation</option>
  </select>
  <button onclick="checkBan()">Check Ban</button>
  <button onclick="clearResults()">Clear Results</button>
</div>

<div class="watchlist-controls">
  <button onclick="addToWatchlist()">Add to Watchlist</button>
  <button onclick="checkAllWatchlist()">Check All Watchlist</button>
  <button onclick="clearWatchlist()">Clear Watchlist</button>
</div>

<div id="watchlist">
  <strong>My Watchlist:</strong>
  <div id="watchlist-names"></div>
</div>

<div id="suggestions" aria-hidden="true"></div>
<div id="results" role="region" aria-live="polite"></div>

<footer>
  Created by Grump E Lemming | please visit my <a href="https://www.youtube.com/@GrumPeLemminG" target="_blank">YouTube channel</a>
</footer>

<div id="updates">
  <strong>Version 1.5 Updates:</strong><br>
  - Check All Watchlist (up to 10 names)<br>
  - Improved error messages and HTTP status handling<br>
  - Watchlist names are highlighted in results
</div>

<script>
/* ---------- storage + autocomplete ---------- */
const playerInputEl = document.getElementById('playerInput');
const suggestionListEl = document.getElementById('suggestions');
let suggestionIndex = -1;
const MAX_SUGGESTIONS = 50;

function getStoredNames(){ return JSON.parse(localStorage.getItem('searchedPlayers') || '[]'); }
function storeName(name){ if(!name) return; let names = getStoredNames(); names.unshift(name); names = [...new Set(names)].slice(0, MAX_SUGGESTIONS); localStorage.setItem('searchedPlayers', JSON.stringify(names)); }
function clearStoredNames(){ localStorage.removeItem('searchedPlayers'); }

function showSuggestions(input){
  suggestionListEl.innerHTML = ''; suggestionIndex = -1;
  if(!input){ suggestionListEl.style.display='none'; suggestionListEl.setAttribute('aria-hidden','true'); return; }
  const names = getStoredNames().filter(n => n.toLowerCase().startsWith(input.toLowerCase()));
  if(!names.length){ suggestionListEl.style.display='none'; suggestionListEl.setAttribute('aria-hidden','true'); return; }
  names.slice(0,30).forEach(match => {
    const div = document.createElement('div'); div.className='suggestion-item'; div.textContent = match;
    div.onclick = ()=>{ playerInputEl.value = match; hideSuggestions(); playerInputEl.focus(); };
    suggestionListEl.appendChild(div);
  });

  // position under input (or above if not enough space)
  suggestionListEl.style.display='block'; suggestionListEl.style.visibility='hidden';
  const rect = playerInputEl.getBoundingClientRect();
  suggestionListEl.style.width = rect.width + 'px';
  const listHeight = suggestionListEl.offsetHeight;
  const spaceBelow = window.innerHeight - rect.bottom - 10;
  const spaceAbove = rect.top - 10;
  let top;
  if(listHeight <= spaceBelow){ top = rect.bottom + window.scrollY + 6; }
  else if(listHeight <= spaceAbove){ top = rect.top + window.scrollY - listHeight - 6; }
  else {
    if(spaceBelow >= spaceAbove){ suggestionListEl.style.maxHeight = Math.max(40, spaceBelow) + 'px'; top = rect.bottom + window.scrollY + 6; }
    else { suggestionListEl.style.maxHeight = Math.max(40, spaceAbove) + 'px'; top = rect.top + window.scrollY - parseInt(suggestionListEl.style.maxHeight,10) - 6; }
  }
  suggestionListEl.style.left = rect.left + window.scrollX + 'px';
  suggestionListEl.style.top = top + 'px';
  suggestionListEl.style.visibility = 'visible';
  suggestionListEl.setAttribute('aria-hidden','false');
}
function hideSuggestions(){ suggestionListEl.style.display = 'none'; suggestionListEl.setAttribute('aria-hidden','true'); suggestionIndex = -1; }

playerInputEl.addEventListener('input', (e) => {
  const v = e.target.value; showSuggestions(v);
  if(v.endsWith(',')) v.split(',').map(p=>p.trim()).filter(Boolean).forEach(storeName);
});

playerInputEl.addEventListener('keydown', (e) => {
  const items = suggestionListEl.getElementsByClassName('suggestion-item');
  if(items.length === 0){
    if(e.key === 'Enter'){ checkBan(); e.preventDefault(); }
    return;
  }
  if(e.key === 'ArrowDown'){ e.preventDefault(); suggestionIndex = (suggestionIndex + 1) % items.length; updateActive(); items[suggestionIndex].scrollIntoView({block:'nearest'}); }
  else if(e.key === 'ArrowUp'){ e.preventDefault(); suggestionIndex = (suggestionIndex - 1 + items.length) % items.length; updateActive(); items[suggestionIndex].scrollIntoView({block:'nearest'}); }
  else if(e.key === 'Enter'){
    if(suggestionIndex >= 0){ playerInputEl.value = items[suggestionIndex].textContent; hideSuggestions(); e.preventDefault(); }
    else { /* let checkBan handle it */ }
  } else if(e.key === 'Escape'){ hideSuggestions(); }
});
function updateActive(){ const items = suggestionListEl.getElementsByClassName('suggestion-item'); Array.from(items).forEach((el,i)=>el.classList.toggle('suggestion-active', i===suggestionIndex)); }
document.addEventListener('click', (evt) => { if(!playerInputEl.contains(evt.target) && !suggestionListEl.contains(evt.target)) hideSuggestions(); });

/* ---------- watchlist ---------- */
function getWatchlist(){ return JSON.parse(localStorage.getItem('watchlist') || '[]'); }
function saveWatchlist(names){ const current = getWatchlist(); const updated = [...new Set([...current, ...names])].slice(0,50); localStorage.setItem('watchlist', JSON.stringify(updated)); renderWatchlist(); }
function renderWatchlist(){ const container = document.getElementById('watchlist-names'); container.innerHTML = ''; getWatchlist().forEach(name => { const div = document.createElement('div'); div.className = 'watchlist-name'; div.innerHTML = `<span>${name}</span><button onclick="removeFromWatchlist('${name.replace(/'/g,"\\'")}')">Remove</button>`; container.appendChild(div); }); }
function addToWatchlist(){ const input = playerInputEl.value.trim(); if(!input){ alert('Enter at least one player name to add.'); return; } const names = input.split(',').map(p=>p.trim()).filter(Boolean); saveWatchlist(names); }
function removeFromWatchlist(name){ let names = getWatchlist(); names = names.filter(n => n !== name); localStorage.setItem('watchlist', JSON.stringify(names)); renderWatchlist(); }
function clearWatchlist(){ if(confirm('Clear all names from your watchlist?')){ localStorage.removeItem('watchlist'); renderWatchlist(); } }

/* Check All Watchlist (v1.5) */
function checkAllWatchlist(){
  const names = getWatchlist();
  if(!names.length){ alert('Watchlist is empty.'); return; }
  if(names.length > 10){
    if(!confirm(`Your watchlist has ${names.length} names. Only the first 10 will be checked now. Continue?`)) return;
  }
  const batch = names.slice(0,10);
  playerInputEl.value = batch.join(', ');
  checkBan();
}

/* ---------- check / render results (improved errors + watchlist highlight) ---------- */
function getStatusClass(status){ switch(status){ case 'Not banned': return 'not-banned'; case 'Temporarily banned': return 'temp-banned'; case 'Permanently banned': return 'perm-banned'; default: return 'unknown'; } }

async function checkBan(){
  const input = playerInputEl.value.trim();
  const platform = document.getElementById('platformSelect').value;
  const resultsDiv = document.getElementById('results');

  if(!input){ alert('Enter at least one player name.'); return; }

  const players = input.split(',').map(p => p.trim()).filter(Boolean);
  if(players.length > 10){ alert('You can only check up to 10 player names at a time.'); return; }

  resultsDiv.innerHTML = "<p class='loading'>Checking… please wait</p>";

  try {
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), 15000); // 15s timeout

    const resp = await fetch(`https://pubg-ban-checker-backend.onrender.com/check-ban?player=${encodeURIComponent(input)}&platform=${platform}`, { signal: controller.signal });
    clearTimeout(timeoutId);

    if(!resp.ok){
      // improved error messages
      if(resp.status === 429){
        resultsDiv.innerHTML = `<p class="unknown">Rate limit exceeded (HTTP 429). Please try fewer names or wait a moment.</p>`;
        return;
      } else if(resp.status === 400){
        const txt = await resp.text().catch(()=>null);
        resultsDiv.innerHTML = `<p class="unknown">Bad request (HTTP 400). ${txt ? txt : ''}</p>`;
        return;
      } else if(resp.status >= 500){
        resultsDiv.innerHTML = `<p class="unknown">Server error (HTTP ${resp.status}). Please try again later.</p>`;
        return;
      } else {
        resultsDiv.innerHTML = `<p class="unknown">Unexpected error (HTTP ${resp.status}).</p>`;
        return;
      }
    }

    const data = await resp.json().catch(()=>null);
    if(!data || !Array.isArray(data.results)){
      resultsDiv.innerHTML = `<p class="unknown">Invalid response from server.</p>`;
      return;
    }

    // render results, highlight if in watchlist
    resultsDiv.innerHTML = '';
    const group = document.createElement('div'); group.className = 'group-result';
    const watch = getWatchlist();
    data.results.forEach((item, i) => {
      const row = document.createElement('div');
      const statusClass = getStatusClass(item.banStatus);
      row.className = 'player-row ' + statusClass;
      row.style.animationDelay = `${i * 0.1}s`;

      // name + watchlist badge
      const left = document.createElement('div');
      left.innerHTML = `<strong>${item.player}</strong>`;
      if(watch.includes(item.player)){
        const badge = document.createElement('span');
        badge.className = 'watchlist-badge';
        badge.textContent = 'Watchlist';
        left.appendChild(badge);
      }

      // status text (right)
      const right = document.createElement('div');
      right.innerHTML = `<span class="status">${item.banStatus}</span>`;

      row.appendChild(left);
      row.appendChild(right);
      group.appendChild(row);
    });

    resultsDiv.appendChild(group);

    // store successful names for autocomplete availability
    players.forEach(storeName);

  } catch (err) {
    if(err.name === 'AbortError'){
      document.getElementById('results').innerHTML = `<p class="unknown">Request timed out after 15 seconds. Try again.</p>`;
    } else {
      document.getElementById('results').innerHTML = `<p class="unknown">Network error: ${err.message}</p>`;
    }
  }
}

/* clear results and keep stored lists; separate clearStoredNames if you want to wipe autocomplete */
function clearResults(){
  document.getElementById('results').innerHTML = '';
  playerInputEl.value = '';
  hideSuggestions();
}

/* initialize watchlist on load */
document.addEventListener('DOMContentLoaded', renderWatchlist);
</script>
</body>
</html>
